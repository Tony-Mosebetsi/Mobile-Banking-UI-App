import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

// --- Main Application Widget ---
class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Soh\'s Payment App',
      theme: ThemeData(
        primarySwatch: Colors.indigo,
        useMaterial3: true,
        inputDecorationTheme: InputDecorationTheme(
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(10),
          ),
        ),
      ),
      // We start on the Login screen (index 0)
      home: const AppContainer(initialPage: 0),
    );
  }
}

// *****************************************************************
// Part 1 & 3: Page Navigation and Transitions
// *****************************************************************

// This widget holds the state for which page is currently displayed, 
// simulating simple page navigation.
class AppContainer extends StatefulWidget {
  final int initialPage;
  const AppContainer({super.key, required this.initialPage});

  @override
  State<AppContainer> createState() => _AppContainerState();
}

class _AppContainerState extends State<AppContainer> {
  // 0: Login Page, 1: Dashboard (Send Money Page)
  late int currentPage; 

  @override
  void initState() {
    super.initState();
    currentPage = widget.initialPage;
  }

  // Simulates login and triggers the custom page transition
  void navigateToDashboard() {
    setState(() {
      currentPage = 1;
    });
  }

  @override
  Widget build(BuildContext context) {
    return AnimatedSwitcher(
      duration: const Duration(milliseconds: 500),
      // Custom Page Transition: Use SlideTransition for smooth flow
      transitionBuilder: (Widget child, Animation<double> animation) {
        // Slide from right to left when navigating to dashboard
        final offsetAnimation = Tween<Offset>(
          begin: const Offset(1.0, 0.0), // Start off-screen right
          end: Offset.zero,
        ).animate(animation);

        return SlideTransition(
          position: offsetAnimation,
          child: child,
        );
      },
      child: currentPage == 0
          ? LoginPage(key: const ValueKey(0), onLogin: navigateToDashboard)
          : const SendMoneyPage(key: ValueKey(1)),
    );
  }
}

// --- Login Page (For Page Transition Demonstration) ---
class LoginPage extends StatelessWidget {
  final VoidCallback onLogin;
  const LoginPage({super.key, required this.onLogin});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Login'),
        backgroundColor: Colors.indigo,
      ),
      body: Center(
        child: Padding(
          padding: const EdgeInsets.all(32.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              const Text('Secure Login', style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold)),
              const SizedBox(height: 30),
              const TextField(
                decoration: InputDecoration(labelText: 'Username'),
              ),
              const SizedBox(height: 20),
              const TextField(
                obscureText: true,
                decoration: InputDecoration(labelText: 'Password'),
              ),
              const SizedBox(height: 30),
              ElevatedButton(
                onPressed: onLogin, // Navigates on click
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.indigo,
                  foregroundColor: Colors.white,
                  padding: const EdgeInsets.symmetric(horizontal: 40, vertical: 15),
                ),
                child: const Text('LOG IN', style: TextStyle(fontSize: 18)),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

// *****************************************************************
// Part 2: Custom/Reusable Widgets (Defined outside the main page)
// *****************************************************************

/// Reusable Custom Button for 'Send Money'
class SendMoneyButton extends StatelessWidget {
  final VoidCallback onPressed;
  final bool isEnabled;

  const SendMoneyButton({
    super.key,
    required this.onPressed,
    required this.isEnabled,
  });

  @override
  Widget build(BuildContext context) {
    return ElevatedButton.icon(
      onPressed: isEnabled ? onPressed : null, // Disable if not enabled
      icon: const Icon(Icons.send),
      label: const Text('Send Money', style: TextStyle(fontSize: 18)),
      style: ElevatedButton.styleFrom(
        backgroundColor: isEnabled ? Colors.green.shade600 : Colors.grey, // Consistent color
        foregroundColor: Colors.white,
        padding: const EdgeInsets.symmetric(vertical: 15),
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(10)),
        elevation: 5,
      ),
    );
  }
}

// *****************************************************************
// Part 1 & 3: Send Money Page (Dashboard with Interactive Widgets)
// *****************************************************************

class SendMoneyPage extends StatefulWidget {
  const SendMoneyPage({super.key});

  @override
  State<SendMoneyPage> createState() => _SendMoneyPageState();
}

class _SendMoneyPageState extends State<SendMoneyPage> {
  final GlobalKey<FormState> _formKey = GlobalKey<FormState>();
  final TextEditingController _nameController = TextEditingController();
  final TextEditingController _amountController = TextEditingController();
  
  String? _paymentMethod = 'Bank Transfer';
  bool _isFavorite = false;
  bool _isSuccess = false; // For AnimatedContainer/Opacity

  final List<String> paymentMethods = ['Bank Transfer', 'EFT', 'Mobile Money', 'Card Payment'];

  @override
  void dispose() {
    _nameController.dispose();
    _amountController.dispose();
    super.dispose();
  }

  void _submitTransaction() {
    if (_formKey.currentState!.validate()) {
      // Logic for successful transaction
      print('--- Transaction Successful ---');
      print('Recipient: ${_nameController.text}');
      print('Amount: R${_amountController.text}');
      print('Method: $_paymentMethod');
      print('Favorite: $_isFavorite');
      print('-----------------------------');

      // Part 3: Trigger Animation
      setState(() {
        _isSuccess = true;
      });

      // Reset state after a delay
      Future.delayed(const Duration(seconds: 3), () {
        if (mounted) {
          setState(() {
            _isSuccess = false;
            _nameController.clear();
            _amountController.clear();
            _paymentMethod = 'Bank Transfer';
            _isFavorite = false;
          });
        }
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // Title Bar
      appBar: AppBar(
        title: const Text('Send Money (Dashboard)'),
        backgroundColor: Colors.indigo,
        foregroundColor: Colors.white,
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(24.0),
        child: Form(
          key: _formKey,
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: <Widget>[
              const Text(
                'New Transaction Details',
                style: TextStyle(fontSize: 22, fontWeight: FontWeight.bold, color: Colors.indigo),
              ),
              const SizedBox(height: 25),

              // --- TextField for Recipient's Name (Validation 1: Not Empty) ---
              TextFormField(
                controller: _nameController,
                decoration: const InputDecoration(
                  labelText: 'Recipient Name',
                  hintText: 'e.g., Jane Doe',
                  prefixIcon: Icon(Icons.person_outline),
                ),
                validator: (value) {
                  if (value == null || value.isEmpty) {
                    return 'Recipient name cannot be empty.'; // Visual feedback (Error Message)
                  }
                  return null;
                },
              ),
              const SizedBox(height: 20),

              // --- TextField for Amount (Validation 2: Positive Number) ---
              TextFormField(
                controller: _amountController,
                keyboardType: TextInputType.number,
                decoration: const InputDecoration(
                  labelText: 'Amount (Rands)',
                  hintText: 'e.g., 500.00',
                  prefixIcon: Icon(Icons.money),
                ),
                validator: (value) {
                  if (value == null || value.isEmpty) {
                    return 'Amount is required.';
                  }
                  final amount = double.tryParse(value);
                  if (amount == null || amount <= 0) {
                    return 'Amount must be a positive number.'; // Visual feedback (Error Message)
                  }
                  return null;
                },
              ),
              const SizedBox(height: 20),

              // --- DropdownButton for Payment Method ---
              DropdownButtonFormField<String>(
                value: _paymentMethod,
                decoration: const InputDecoration(
                  labelText: 'Payment Method',
                  prefixIcon: Icon(Icons.payment),
                ),
                items: paymentMethods.map((String method) {
                  return DropdownMenuItem<String>(
                    value: method,
                    child: Text(method),
                  );
                }).toList(),
                onChanged: (String? newValue) {
                  setState(() {
                    _paymentMethod = newValue;
                  });
                },
              ),
              const SizedBox(height: 30),

              // --- Switch for Favorite Transaction ---
              Row(
                children: [
                  const Icon(Icons.favorite_border, color: Colors.red),
                  const SizedBox(width: 10),
                  const Expanded(
                    child: Text(
                      'Mark as Favorite Transaction',
                      style: TextStyle(fontSize: 16),
                    ),
                  ),
                  Switch(
                    value: _isFavorite,
                    onChanged: (bool value) {
                      setState(() {
                        _isFavorite = value;
                      });
                    },
                    activeColor: Colors.red,
                  ),
                ],
              ),
              const SizedBox(height: 40),

              // --- Custom Reusable Button (Part 2) ---
              SendMoneyButton(
                onPressed: _submitTransaction,
                isEnabled: true, // Always enabled if form fields are handled by validator
              ),
              const SizedBox(height: 40),

              // --- Animation: Success Message (Part 3: AnimatedOpacity) ---
              // AnimatedOpacity provides a smooth fade-in/out effect
              AnimatedOpacity(
                opacity: _isSuccess ? 1.0 : 0.0,
                duration: const Duration(milliseconds: 500),
                child: Container(
                  padding: const EdgeInsets.all(20),
                  decoration: BoxDecoration(
                    color: Colors.green.shade50,
                    borderRadius: BorderRadius.circular(10),
                    border: Border.all(color: Colors.green.shade300),
                  ),
                  child: const Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      Icon(Icons.check_circle, color: Colors.green, size: 30),
                      SizedBox(width: 10),
                      Text(
                        'Transaction Successful!',
                        style: TextStyle(fontSize: 18, color: Colors.green, fontWeight: FontWeight.bold),
                      ),
                    ],
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
